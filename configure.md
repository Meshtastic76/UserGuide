[Главная](README.md) > [Выбор](choose.md) > [Прошивка](install.md)

# ⚙️ Базовые настройки ноды для работы в Ярославской сети

## [LoRa](#LoRa)
| Параметр               | Значение                    | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ---------------------- | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Регион                 | Россия                      |                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Использовать шаблон    | Вкл                         |                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Шаблон                 | Большая дальность - Быстрый | Long fast                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ОК в MQTT              | Вкл                         | Выкл - если не хотите передавать данные в MQTT                                                                                                                                                                                                                                                                                                                                                                                              |
| Передача включена      | Вкл                         |                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Количество прыжков *   | 4                           | 4 Если вы находитесь в центре сети или на возвышенности и с хорошим приемом и передачей. **Этого должно хватать.**<br>5 Если вы находитесь на окраине сети (или в зоне плохого сигнала) и вас иногда спасает один лишний прыжок<br>6, 7 Если ваш сигнал точно без промежуточной одной или двух нод не попадает в сеть (Так же если вы <br>в зоне плохого сигнала (например внутри здания) и используете связку CLIENT_MUTE -> CLIENT_BASE ) |
| Частота слота          | 2                           | Должно установиться автоматически при выборе шаблона                                                                                                                                                                                                                                                                                                                                                                                        |
| Переопределить частоту | 869.075                     | Должно установиться автоматически при выборе шаблона                                                                                                                                                                                                                                                                                                                                                                                        |
| Мощность передатчика   | 20                          | Можно изменить при необходимости, например наличие более мощной выходной ноды на районе                                                                                                                                                                                                                                                                                                                                                     |

\* Разработчики Meshtastic рекомендуют использовать 3 прыжка. Увеличение количества прыжков само по себе нагружает сеть. Старайтесь минимизировать нужное вам
количество прыжков. В этом вам поможет хорошая антенна для вашего устройства (и, по возможности, вынос антенны вместе с устройством на улицу)!

##### Быстрые "вопросы ответы":

В: Как считается число прыжков (хопов)

О: Первая передача - счиается прямой. Прыжки начинают считаться со второй передачи. Наример: Petya -> Vasya -> Kolya это 1 прыжок.


В: У меня Traceroute показывает 7 хопов. А вы рекомендуете 4? Мне нужно по максимуму! Я поставлю 7 и мне пофиг!

О: Если в результате трейсинга пакет идет не по оптимальному маршруту, значит ноды, которые могли бы его передать с меньшим количеством хопов - загружены передачей других пакетов.
Не нормально, когда сообщение, которое может быть передано через 1 хоп за 2-3 секунды, идет через 5 и более хопов за 15-20-30 и более секунд. Решение в уменьшении нагрузки на сеть и скоординированных действиях сообщества по минимизации технического трафика в сети.

В: Я сделал Traceroute и он прошел, а сообщение в ЛС не доходит, почему? Или наоборот: сообщение дошло, а нода не трейсится? Или то доходит, то нет, что делать?

О: Тут может быть несколько вариантов: 
1. У вас реально плохая доступность до хороших базовых станций. Улучшите антенну (Желательно чтобы вас слышали хотя бы 3 разных узла напрямую, которые сами имеют хороший выход в сеть)
2. Эти базовые станции перегружены обработкой других пакетов и ваш пакет то успевают обработать, то нет.
3. Возможно между вами и получателем есть нода "бутылочное горлышко", которая так же может быть перегружена или радио волну она то ловит, то нет.
4. Если трейсинг занимает **X секунд**. То и ждать ответа с подтверждением доставки от ноды, которой вы послали ЛС нужно **X секунд**. Не нужно сразу же посылать и посылать еще сообщения, этим вы сделаете только хуже, устроив ddos-атаку самостоятельно.
*(В разработке... Возможно блок с вопросами-ответами нужно перенести куда-то в отдельное месте, оставив тут только ссылку на него)*
---

## [Каналы](#Каналы)
| Параметр   | Значение | Комментарий                                                            |
| ---------- | -------- | ---------------------------------------------------------------------- |
| Имя канала | LongFast | Должен установиться сам по умолчанию при выборе шаблона в разделе LoRa |
| PSK        | AQ==     | Должен установиться сам по умолчанию при выборе шаблона в разделе LoRa |

## [Пользователь](#Пользователь)
| Параметр | Значение | Комментарий |
| -------- | -------- | ----------- |
| Полное имя | %на_ваш_выбор% | Есть правила именования, указаны ниже!!! |
| Короткое имя | %на_ваш_выбор% | 4 символа или emoji |
| Uplink включен | Вкл |  |
| Downlink включен | По желанию |  |
| Местоположение включено | Вкл | Выкл - если не хотите передавать данные о местоположении |
| Точность местоположения | Выкл |  |
| Расстояние | По желанию | Рекомендуется не менее 1.5 км |

Правила именования нод:
1. Если нода не имеет постоянного места нахождения и постоянно переносится с собой, ее можно назвать любым удобным способом
2. Если нода всегда стоит на одном месте, она является статичной/базовой, ее следует назвать по шаблону: "РАЙОН_объект имя" или "РАЙОН имя", пример - "CNTR_volkovsky MyAwesomeNick"
  - Район: CNTR/LEN/FRNZ/NEFT/ZAV/DZR/RZT/KARM
  - Объект: Общественно значимое место которое знают все, рядом с которым находится нода (не обязательно, в целях сохранения приватности)
  - Имя: Произвольное имя, на ваш вкус

⚠️ Формат еще обсуждается в сообществе, много нод названо по шаблону "RAYON.B_object_nickname" или "RAYON.B_nickname" где ".B" означает, что нода имеет статичное расположение

## [Устройство](#Устройство)
| Параметр                            | Значение                           | Комментарий                                       |
| ----------------------------------- | ---------------------------------- | ------------------------------------------------- |
| Роль                                | CLIENT / CLIENT_BASE / CLIENT_MUTE | Используются 3 основные роли, правила выбора ниже |
| Режим ретрансляции                  | CORE_PORTNUMS_ONLY                 |                                                   |
| Интервал вещания информации об узле | Three Hours                        | 3 часа                                            |
| Часовой пояс                        | GMT-3                              |                                                   |
|                                     |                                    |                                                   |
|                                     |                                    |                                                   |

## [Правила выбора роли](#Правила_выбора_роли)
| Роль        | Описание                                                                                                | Cценарий использования                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ----------- | ------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CLIENT      | Меш-узел с функцией ретрансляции.                                                                       | **Правильный выбор для большинства ситуаций.**                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| CLIENT_BASE | Отличие от CLIENT в возможности указать ИЗБРАННЫЕ ноды, пакеты от которых будет пересылать приоритетно. | Для установки на высокой крыше, верхних этажах высотных зданий. С хорошей антенной. Для ретрансляции пакетов со своих узлов, расположенных ниже и обладающих антенной похуже. CLIENT_BASE **имеет смысл устанавливать только при наличии узлов, которые будут добавлены в ИЗБРАННЫЕ**, потому что если таких не будет, роль ведет себя как CLIENT. С узлами которые не добавлены в ИЗБРАННЫЕ ведет себя как CLIENT - ретранслирует их пакеты тоже, но с меньшим приоритетом.<br> |
| CLIENT_MUTE | Отличие от CLIENT в отсутствии поддержки ретрансляции чужих пакетов.                                    | Идеально для карманных, мобильных нод в корпусе с небольшим аккумулятором и небольшой антенной. При настройке на рассылку минимального количества технических широковещательных пакетов, эта роль **очень экономит батарейку!** Один из вариантов использования: совместно с другой своей нодой, настроенной в CLIENT_BASE (у которой CLIENT_MUTE добавлен в изранные)                                                                                                           |
| ПРОЧИЕ РОЛИ | Категорически не рекомендуем включать.                                                                  | Использовать только после консультаций в ТГ с сообществом, если понимаете зачем это нужно. Т.к. их использование может оказать значительное негативное воздействие на всю сеть.                                                                                                                                                                                                                                                                                                  |

### [MQTT](#MQTT)
Не обязательно включать! Если у вас нода с хорошей слышимостью, то можно помочь сообществу в сборе статистики, отправив пакеты на MQTT сервер.
Для этого установите следующие настройки:

| Параметр               | Значение        | Комментарий                                           |
| ---------------------- | --------------- | ----------------------------------------------------- |
| MQTT включен           | Вкл             |                                                       |
| Адрес                  | mqtt.onemesh.ru |                                                       |
| Имя пользователя       | onemesh         |                                                       |
| Пароль                 | onecat          |                                                       |
| Шифрование             | Вкл             |                                                       |
| Вывод JSON включен     | Выкл            |                                                       |
| TLS включен            | Выкл            |                                                       |
| Корневая тема          | msh/RU/YAR      |                                                       |
| Отчеты по карте        | Вкл             | ТОЛЬКО если хотите что бы нода отображаласть на карте |
| Я согласен             | Вкл             | ТОЛЬКО если хотите что бы нода отображаласть на карте |
| Интервал отсчета карты | 1 hour          |                                                       |

# ⚙️ Настройка периодичности рассылки технических пакетов
⚠️ Настройка этих параметров **крайне важна**, чтобы не создавать в сети излишнюю нагрузку. 
К сожалению, параметры по-умолчанию в приложении предлагают короткие интервалы рассылки технических пакетов,
что совершенно не подходит для сети размеров города. Поэтому отнеситесь к настройке этих параметров серьезно. 
**Даже если вы используете CLIENT_MUTE ваша нода способна устроить большую перегрузку в сети, если не настроить эти параметры правильно!**
Увеличение количества нод должно приводить к улучшению покрытия и стабильности связи, а не к увеличению шума в эфире. Это возможно только при 
снижении объема технического трафика в сети. Несоблюдение ограничения на спам техническими пакетами может приводить к ddos-у отдельных узлов
сети и если эти узлы оказываются ключевыми связующими районы узлами - то связь теряется, сколько бы хопов вы не увеличивали в настройках.
Давайте сделаем так, чтобы эфир почаще был свободным от технических пакетов и побольше загружен действительно полезной нагрузкой - текстовыми сообщениями!

## [Информация о ноде](#Информация_о_ноде)
Настройки -> Устройство -> Интервал вещания инфомации об узле
Передает название ноды, основные ее параметры и самое главное - открытый ключ, для возможности писать личные сообщения.

| Параметр          | Для статичной ноды | Для переносной ноды | Комментарий |
| ----------------- | ------------------ | ------------------- | ----------- |
| Период трансляции | Twelve Hours       | Twelve Hours        | 12 часов    |
|                   |                    |                     |             |
⚠️**Важно:** 
1. При такой настройке новое устройство в сети поймает все ноды за 12 часов. Т.е. вся сеть у вас сразу не отобразится, **нужно будет подождать**.
2. Приложение для телефона выкидывает все ноды фильтром "Скрыть узлы оффлайн", которые не отправляли пакетов в течении часа. Так что на этот фильтр не смотрим для определения того оффлайн нода или онлайн. Лучше один раз сделать Traceroute до ноды которой вы хотите написать в ЛС,  чтобы проверить, что она на связи, чем этой ноде часто напрягать сеть периодической широковещательно рассылкой.

## [Местоположение](#Местоположение)
Местоположение может браться как с датчика GPS встроенного в ноду (при наличии), так и с подключенного телефона.

| Параметр                        | Для статичной ноды | Для переносной ноды | Комментарий |
| ------------------------------- | ------------------ | ------------------- | ----------- |
| Период трансляции *\*см. Ввжно* | Twenty Four Hours  | Twenty Four Hours   | 24 часа     |
| Умная позиция                   | Выкл               | Вкл                 |             |
| Минимальный интервал            | -                  | Ten minutes         | 10 минут    |
| Минимальная дистанция           | -                  | 1000                |             |
| Фиксированное положение         | Вкл                | Выкл                |             |
⚠️**Важно:** 
1. Для тех, у кого мобильная нода. Подумайте, Вы вообще уверены, что данные о положении своей мобильной ноды вы хотите отправлять широковещательно всем, а до кучи еще на всю страну? (Через MQTT все сливается в интернет). Если нет: выключите умную позицию и настройте ноду как статичную. Используйте возможности трекера **только когда вам это действительно полезно**. Не используйте рассылку чаще рекомендованных раз в 10 минут, если есть возможность реже - ставьте реже. **По окончании трекинга, обязательно верните настройки в режим редкой отправки широковещательных пакетов о местоположении!**
2. Для статичных нод важно отправить свою позицию, чтобы другие участники сети знали например как расположить направленную антенну. Один раз в сутки - достаточно.
3. **В городе работает GPS спуффер, если не умеете его обходить - установите фиксированные координаты** на статичной ноде или отключите передачу локации на переносной

## [Телеметрия](#Телеметрия)
Передает состояние *заряда батареи*, *напряжение* и *время работы* ноды с последней перезагрузки.
А так же состояние дополнительных датчиков установленных на плате, если вы их ставили.

| Параметр                                                                          | Для статичной ноды | Для переносной ноды | Комментарий |
| --------------------------------------------------------------------------------- | ------------------ | ------------------- | ----------- |
| Период трансляции *\*см. Ввжно*                                                   | Twenty Four Hours  | Twenty Four Hours   | 24 часа     |
| (Настроек много, *раздел дорабатывается...<br>требуется мнение имеющего датчики*) |                    |                     |             |
⚠️ **Важно:** 
1. Если у вас статичная нода питающаяся от сети и в ней нет каких-то дополнительных датчиков, полезных сообществу - **отключите рассылку телеметрии!**
2. Если у вас нода питающаяся от батарейки бывает удобно удаленно посмотреть количество оставшегося заряда. Рассчитайте период трансляции пакетов с телеметрией самостоятельно. Желательно чтобы в результате расчета получилось не больше 8-х раз в сутки.
3. Если у вас есть всякие важные датчики - температуры, влажности, дождя, ветра или даже уровня радиации - настройте рассылку телеметрии на 1 раз в час. Если требуется больше,
	лучше предупредить сообщество в ТГ канале (чтобы вас не внесли в число спамеров).


## ⏩ Следующий шаг
[Известные проблемы](issues.md)
